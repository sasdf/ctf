<!DOCTYPE HTML><html lang=""><head><meta charset="UTF-8"><meta content="text/html; charset=utf-8"http-equiv="Content-Type"><title>crypwn - Secret Note Â· GitBook</title><meta content="IE=edge"http-equiv="X-UA-Compatible"/><meta content=""name="description"><meta content="GitBook 3.2.3"name="generator"><link href="../../../../../gitbook/style.css"rel="stylesheet"><link href="../../../../../gitbook/gitbook-plugin-katex/katex.min.css"rel="stylesheet"><link href="../../../../../gitbook/gitbook-plugin-disqus/plugin.css"rel="stylesheet"><link href="../../../../../gitbook/gitbook-plugin-prism/prism-tomorrow.css"rel="stylesheet"><link href="../../../../../gitbook/gitbook-plugin-writeup-utils/plugin.css"rel="stylesheet"><link href="../../../../../gitbook/gitbook-plugin-search/search.css"rel="stylesheet"><link href="../../../../../gitbook/gitbook-plugin-fontsettings/website.css"rel="stylesheet"><meta content="true"name="HandheldFriendly"/><meta content="width=device-width,initial-scale=1,user-scalable=no"name="viewport"><meta content="yes"name="apple-mobile-web-app-capable"><meta content="black"name="apple-mobile-web-app-status-bar-style"><link href="../../../../../gitbook/images/apple-touch-icon-precomposed-152.png"rel="apple-touch-icon-precomposed"sizes="152x152"><link href="../../../../../gitbook/images/favicon.ico"rel="shortcut icon"type="image/x-icon"><link href="../lostmod/"rel="prev"/></head><body><div class="book"><div class="book-summary"><nav role="navigation"><ul class="summary"><li class="chapter"data-level="1.1"data-path="../../../../../"><a href="../../../../../">Introduction</a></li><li class="header">Writeups</li><li class="header">2020</li><li class="chapter"data-level="3.1"><span>Google</span><ul class="articles"><li class="chapter"data-level="3.1.1"data-path="../../../../2020/google/crypto/oracle/"><a href="../../../../2020/google/crypto/oracle/">crypto - Oracle</a></li><li class="chapter"data-level="3.1.2"data-path="../../../../2020/google/crypto/yafm/"><a href="../../../../2020/google/crypto/yafm/">crypto - YAFM</a></li><li class="chapter"data-level="3.1.3"data-path="../../../../2020/google/crypto/quantum/"><a href="../../../../2020/google/crypto/quantum/">crypto - Quantum Pyramids</a></li><li class="chapter"data-level="3.1.4"data-path="../../../../2020/google/crypto/sharky/"><a href="../../../../2020/google/crypto/sharky/">crypto - SHArky</a></li></ul></li><li class="header">2019</li><li class="chapter"data-level="4.1"><span>Google</span><ul class="articles"><li class="chapter"data-level="4.1.1"data-path="../../../../2019/google/crypto/reality/"><a href="../../../../2019/google/crypto/reality/">crypto - reality</a></li><li class="chapter"data-level="4.1.2"data-path="../../../../2019/google/crypto/qkd/"><a href="../../../../2019/google/crypto/qkd/">crypto - Quantum Key Distribution</a></li><li class="chapter"data-level="4.1.3"data-path="../../../../2019/google/crypto/cell/"><a href="../../../../2019/google/crypto/cell/">crypto - Reverse a cellular automata</a></li><li class="chapter"data-level="4.1.4"data-path="../../../../2019/google/hardware/flagrom/"><a href="../../../../2019/google/hardware/flagrom/">hardware - flagrom</a></li><li class="chapter"data-level="4.1.5"data-path="../../../../2019/google/hardware/minetest/"><a href="../../../../2019/google/hardware/minetest/">hardware - minetest</a></li><li class="chapter"data-level="4.1.6"data-path="../../../../2019/google/hardware/remote/"><a href="../../../../2019/google/hardware/remote/">hardware - Remote Control</a></li><li class="chapter"data-level="4.1.7"data-path="../../../../2019/google/web/glotto/"><a href="../../../../2019/google/web/glotto/">web - gLotto</a></li><li class="chapter"data-level="4.1.8"data-path="../../../../2019/google/rev/dial/"><a href="../../../../2019/google/rev/dial/">rev - Dialtone</a></li></ul></li><li class="chapter"data-level="4.2"><span>Plaid</span><ul class="articles"><li class="chapter"data-level="4.2.1"data-path="../../../../2019/plaid/crypto/cypress/"><a href="../../../../2019/plaid/crypto/cypress/">crypto - SPlaid Cypress</a></li><li class="chapter"data-level="4.2.2"data-path="../../../../2019/plaid/rev/bigmaffs/"><a href="../../../../2019/plaid/rev/bigmaffs/">rev - big maffs</a></li></ul></li><li class="header">2018</li><li class="chapter"data-level="5.1"><span>hxp</span><ul class="articles"><li class="chapter"data-level="5.1.1"data-path="../../../hxp/crypto/blinder_v2/"><a href="../../../hxp/crypto/blinder_v2/">crypto - blinder_v2</a></li><li class="chapter"data-level="5.1.2"data-path="../../../hxp/crypto/blinder/"><a href="../../../hxp/crypto/blinder/">crypto - blinder</a></li><li class="chapter"data-level="5.1.3"data-path="../../../hxp/crypto/curve/"><a href="../../../hxp/crypto/curve/">crypto - curve12833227</a></li><li class="chapter"data-level="5.1.4"data-path="../../../hxp/crypto/oops/"><a href="../../../hxp/crypto/oops/">crypto - oops2</a></li><li class="chapter"data-level="5.1.5"data-path="../../../hxp/crypto/blind/"><a href="../../../hxp/crypto/blind/">crypto - blind</a></li></ul></li><li class="chapter"data-level="5.2"><span>Pwn2Win</span><ul class="articles"><li class="chapter"data-level="5.2.1"data-path="../../../pwn2win/rev/back_to_bletchley_park/"><a href="../../../pwn2win/rev/back_to_bletchley_park/">cryrev - Back To Bletchley Park</a></li><li class="chapter"data-level="5.2.2"data-path="../../../pwn2win/crypto/GCM/"><a href="../../../pwn2win/crypto/GCM/">crypto - GCM</a></li></ul></li><li class="chapter"data-level="5.3"><span>HITCON</span><ul class="articles"><li class="chapter"data-level="5.3.1"data-path="../lostmod/"><a href="../lostmod/">crypto - Lost Modulus</a></li><li class="chapter active"data-level="5.3.2"data-path="./"><a href="./">crypwn - Secret Note</a></li></ul></li><li class="chapter"data-level="5.4"><span>Hack.lu</span><ul class="articles"><li class="chapter"data-level="5.4.1"data-path="../../../Hack.lu/crypto/escape/"><a href="../../../Hack.lu/crypto/escape/">crypto - Escape the Grid</a></li><li class="chapter"data-level="5.4.2"data-path="../../../Hack.lu/crypto/relation/"><a href="../../../Hack.lu/crypto/relation/">crypto - Relations</a></li><li class="chapter"data-level="5.4.3"data-path="../../../Hack.lu/crypto/lfsr/"><a href="../../../Hack.lu/crypto/lfsr/">crypto - LFSR StreamCipher</a><ul class="articles"><li class="chapter"data-level="5.4.3.1"data-path="../../../Hack.lu/crypto/lfsr/task.html"><a href="../../../Hack.lu/crypto/lfsr/task.html">task description</a></li></ul></li></ul></li><li class="chapter"data-level="5.5"><span>Hackover</span><ul class="articles"><li class="chapter"data-level="5.5.1"data-path="../../../HackOver/crypto/oblivious/"><a href="../../../HackOver/crypto/oblivious/">crypto - oblivious</a></li><li class="chapter"data-level="5.5.2"data-path="../../../HackOver/crypto/secure_hash_v2/"><a href="../../../HackOver/crypto/secure_hash_v2/">crypto - secure_hash_v2</a></li><li class="chapter"data-level="5.5.3"data-path="../../../HackOver/rev/flagmaker/"><a href="../../../HackOver/rev/flagmaker/">rev - flagmaker</a></li></ul></li><li class="chapter"data-level="5.6"><span>Teaser Dragon</span><ul class="articles"><li class="chapter"data-level="5.6.1"data-path="../../../TeaserDragon/rev/Chains of trust/"><a href="../../../TeaserDragon/rev/Chains of trust/">rev - Chains of trust</a></li></ul></li><li class="chapter"data-level="5.7"><span>Defcamp</span><ul class="articles"><li class="chapter"data-level="5.7.1"data-path="../../../defcamp/rev/validator/"><a href="../../../defcamp/rev/validator/">rev - validator</a></li><li class="chapter"data-level="5.7.2"data-path="../../../defcamp/rev/memsome/"><a href="../../../defcamp/rev/memsome/">rev - memsome</a></li><li class="chapter"data-level="5.7.3"data-path="../../../defcamp/web/secops/"><a href="../../../defcamp/web/secops/">web - secops</a></li><li class="chapter"data-level="5.7.4"data-path="../../../defcamp/web/chat/"><a href="../../../defcamp/web/chat/">web - chat</a></li><li class="chapter"data-level="5.7.5"data-path="../../../defcamp/misc/voices/"><a href="../../../defcamp/misc/voices/">misc - voices</a></li></ul></li><li class="chapter"data-level="5.8"><span>HackIT</span><ul class="articles"><li class="chapter"data-level="5.8.1"data-path="../../../HackIT/coffee_overflow/"><a href="../../../HackIT/coffee_overflow/">rev - coffee_overflow</a></li></ul></li><li class="header">My Tasks</li><li class="header">2018</li><li class="chapter"data-level="7.1"><span>AIS3 Final</span><ul class="articles"><li class="chapter"data-level="7.1.1"data-path="../../../../../tasks/2018/ais3Final/crypto/100-mama/"><a href="../../../../../tasks/2018/ais3Final/crypto/100-mama/">crypto - mama</a></li><li class="chapter"data-level="7.1.2"data-path="../../../../../tasks/2018/ais3Final/crypto/200-secureSub/"><a href="../../../../../tasks/2018/ais3Final/crypto/200-secureSub/">crypto - secureSub</a></li><li class="chapter"data-level="7.1.3"data-path="../../../../../tasks/2018/ais3Final/crypto/300-xorlnarmoni'akda/"><a href="../../../../../tasks/2018/ais3Final/crypto/300-xorlnarmoni'akda/">crypto - xorlnarmoni'akda</a></li><li class="chapter"data-level="7.1.4"data-path="../../../../../tasks/2018/ais3Final/rev/100-SecDES/"><a href="../../../../../tasks/2018/ais3Final/rev/100-SecDES/">rev - SecDES</a></li><li class="chapter"data-level="7.1.5"data-path="../../../../../tasks/2018/ais3Final/rev/200-AlmightyDuctTape/"><a href="../../../../../tasks/2018/ais3Final/rev/200-AlmightyDuctTape/">rev - Almighty Duct Tape</a></li></ul></li><li class="header">2019</li><li class="chapter"data-level="8.1"><span>Balsn CTF</span><ul class="articles"><li class="chapter"data-level="8.1.1"data-path="../../../../../tasks/2019/BalsnCTF/"><a href="../../../../../tasks/2019/BalsnCTF/">Overview</a></li><li class="chapter"data-level="8.1.2"data-path="../../../../../tasks/2019/BalsnCTF/crypto/collision/"><a href="../../../../../tasks/2019/BalsnCTF/crypto/collision/">crypto - collision</a></li><li class="chapter"data-level="8.1.3"data-path="../../../../../tasks/2019/BalsnCTF/crypto/harc4/"><a href="../../../../../tasks/2019/BalsnCTF/crypto/harc4/">crypto - harc4</a></li><li class="chapter"data-level="8.1.4"data-path="../../../../../tasks/2019/BalsnCTF/crypto/unpredictable/"><a href="../../../../../tasks/2019/BalsnCTF/crypto/unpredictable/">crypto - unpredictable</a></li><li class="chapter"data-level="8.1.5"data-path="../../../../../tasks/2019/BalsnCTF/pwn/securenote/"><a href="../../../../../tasks/2019/BalsnCTF/pwn/securenote/">crypwn - securenote</a></li><li class="chapter"data-level="8.1.6"data-path="../../../../../tasks/2019/BalsnCTF/misc/pyshv1/"><a href="../../../../../tasks/2019/BalsnCTF/misc/pyshv1/">misc - pyshv1</a></li><li class="chapter"data-level="8.1.7"data-path="../../../../../tasks/2019/BalsnCTF/misc/pyshv2/"><a href="../../../../../tasks/2019/BalsnCTF/misc/pyshv2/">misc - pyshv2</a></li><li class="chapter"data-level="8.1.8"data-path="../../../../../tasks/2019/BalsnCTF/misc/pyshv3/"><a href="../../../../../tasks/2019/BalsnCTF/misc/pyshv3/">misc - pyshv3</a></li><li class="chapter"data-level="8.1.9"data-path="../../../../../tasks/2019/BalsnCTF/misc/john/"><a href="../../../../../tasks/2019/BalsnCTF/misc/john/">misc - john</a></li><li class="chapter"data-level="8.1.10"data-path="../../../../../tasks/2019/BalsnCTF/rev/plam/"><a href="../../../../../tasks/2019/BalsnCTF/rev/plam/">rev - plam</a></li><li class="chapter"data-level="8.1.11"data-path="../../../../../tasks/2019/BalsnCTF/rev/vim/"><a href="../../../../../tasks/2019/BalsnCTF/rev/vim/">rev - vim</a></li></ul></li><li class="divider"></li><li><a href="https://www.gitbook.com"target="blank"class="gitbook-link">Published with GitBook</a></li></ul></nav></div><div class="book-body"><div class="body-inner"><div class="book-header"role="navigation"><h1><i class="fa fa-circle-o-notch fa-spin"></i> <a href="../../../../..">crypwn - Secret Note</a></h1></div><div class="page-wrapper"role="main"tabindex="-1"><div class="page-inner"><section class="markdown-section normal"><div class="wpHeaderContainer"><h1 id="secret-note">Secret Note</h1><div><span><a href="https://github.com/sasdf/ctf/blob/master/writeup/2018/hitcon/crypto/secret"target="_blank"><img alt="Attachments"src="https://img.shields.io/badge/-Attachments-lightgrey.svg?style=for-the-badge&amp;maxAge=3600&amp;logo=github"></a></span><span><img alt="crypwn - 342"src="https://img.shields.io/badge/crypwn-342-green.svg?style=for-the-badge&amp;maxAge=3600"></span><span><img alt="9 solves"src="https://img.shields.io/badge/solves-9-lightseagreen.svg?style=for-the-badge&amp;maxAge=3600"></span></div></div><p></p><blockquote><p>UPDATE: Running on Ubuntu 18.04 plz read the note</p></blockquote><h2 id="time">Time</h2><p>6 hours</p><h2 id="behavior">Behavior</h2><p>The service has two kinds of note:</p><p>Type 1 is encrypted by RSA, i.e. <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>m</mi><mn>217</mn></msup><mtext>&#xA0;</mtext><mspace></mspace><mspace width="0.6666666666666666em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>&#x2009;</mtext><mtext>&#x2009;</mtext><mi>n</mi></mspace></mrow><annotation encoding="application/x-tex">m^{217}\ \mod n</annotation></semantics></math></span><span class="katex-html"aria-hidden="true"><span class="base"><span class="strut"style="height:.8141079999999999em;vertical-align:0"></span><span class="mord"><span class="mord mathit">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist"style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut"style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span><span class="mord mtight">7</span></span></span></span></span></span></span></span></span><span class="mspace">&#xA0;</span><span class="mspace allowbreak"></span><span class="mspace"style="margin-right:.6666666666666666em"></span></span><span class="base"><span class="strut"style="height:.69444em;vertical-align:0"></span><span class="mord"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace"style="margin-right:.16666666666666666em"></span><span class="mspace"style="margin-right:.16666666666666666em"></span><span class="mord mathit">n</span></span></span></span> for our input <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html"aria-hidden="true"><span class="base"><span class="strut"style="height:.43056em;vertical-align:0"></span><span class="mord mathit">m</span></span></span></span>, where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html"aria-hidden="true"><span class="base"><span class="strut"style="height:.43056em;vertical-align:0"></span><span class="mord mathit">n</span></span></span></span> is fixed and known.</p><p>Type 2 is encrypted by AES, where key is fixed but unknown, and iv is random among each connection.</p><p>The service stores the note in plaintext. When we call <code>show</code> command, it will encrypt the note and return the result.</p><p>There are two default notes, the first one is the flag with AES encryption, and the second one is AES key with RSA encryption.</p><h1 id="solution">Solution</h1><h2 id="tldr">TL;DR</h2><ol><li>Overflow to change N.</li><li>Collect many encrypted AES key with different N.</li><li>Get <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mtext>key</mtext><mn>217</mn></msup></mrow><annotation encoding="application/x-tex">\text{key}^{217}</annotation></semantics></math></span><span class="katex-html"aria-hidden="true"><span class="base"><span class="strut"style="height:1.0928879999999999em;vertical-align:-.19444em"></span><span class="mord"><span class="mord text"><span class="mord">key</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist"style="height:.8984479999999999em"><span style="top:-3.1473400000000002em;margin-right:.05em"><span class="pstrut"style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span><span class="mord mtight">7</span></span></span></span></span></span></span></span></span></span></span></span> using CRT.</li><li>Get the key by calculate its 217-th root.</li><li>Leak the iv with all zeros plaintext.</li><li>Decrypt the flag.</li></ol><p>After <a href="https://github.com/sasdf/ctf/blob/master/writeup/2018/hitcon/crypto/secret/_files/rev.py"target="_blank">reversing the binary</a>, the encryption algorithm of type 1 turns out to be AES-128-CBC, which is not breakable under current tech. So we&apos;ve tried hard to factorize the N but failed.</p><p>Recall that this challenge is crypto + pwn, I decided to dig into the binary again, I found that it has 12 bytes heap overflow. When the length of our plaintext is multiple of 16, PKCS7 padding will pad one more block at the end, but it doesn&apos;t calloc enough space for the additional block.</p><p>Moreover, there&apos;s an unsorted bin in front of the heap chunk of mpz storing N, so that we can allocate before N and overflow to change it. With many ciphertext of different N, we can perform hastad broadcast attack to recover the plaintext.</p><p>Before that, we need to know what is N after overflow. We can eliminate the effect of iv with following equation: <span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mtext>Enc</mtext><mtext>iv</mtext></msub><mo>(</mo><msub><mi>m</mi><mn>1</mn></msub><mtext>&#xA0;</mtext><mi mathvariant="normal">&#x2223;</mi><mi mathvariant="normal">&#x2223;</mi><mtext>&#xA0;</mtext><msub><mtext>Enc</mtext><mtext>iv</mtext></msub><mo>(</mo><msub><mi>m</mi><mn>1</mn></msub><mo>)</mo><mo>&#x2295;</mo><msub><mi>m</mi><mn>2</mn></msub><mo>)</mo><mo>=</mo><msub><mtext>Enc</mtext><mtext>iv</mtext></msub><mo>(</mo><msub><mi>m</mi><mn>1</mn></msub><mo>)</mo><mtext>&#xA0;</mtext><mi mathvariant="normal">&#x2223;</mi><mi mathvariant="normal">&#x2223;</mi><mtext>&#xA0;</mtext><msub><mtext>Enc</mtext><mn>0</mn></msub><mo>(</mo><msub><mi>m</mi><mn>2</mn></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">\text{Enc}_{\text{iv}}(m_1\ ||\ \text{Enc}_{\text{iv}}(m_1) \oplus m_2) = \text{Enc}_{\text{iv}}(m_1)\ ||\ \text{Enc}_{0}(m_2)</annotation></semantics></math></span><span class="katex-html"aria-hidden="true"><span class="base"><span class="strut"style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord text"><span class="mord">Enc</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"style="height:.31750199999999995em"><span style="top:-2.5500000000000003em;margin-right:.05em"><span class="pstrut"style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight text"><span class="mord mtight">iv</span></span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist"style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut"style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist"style="height:.15em"><span></span></span></span></span></span></span><span class="mspace">&#xA0;</span><span class="mord">&#x2223;</span><span class="mord">&#x2223;</span><span class="mspace">&#xA0;</span><span class="mord"><span class="mord text"><span class="mord">Enc</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"style="height:.31750199999999995em"><span style="top:-2.5500000000000003em;margin-right:.05em"><span class="pstrut"style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight text"><span class="mord mtight">iv</span></span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist"style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut"style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist"style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace"style="margin-right:.2222222222222222em"></span><span class="mbin">&#x2295;</span><span class="mspace"style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut"style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathit">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut"style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist"style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace"style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace"style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut"style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord text"><span class="mord">Enc</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"style="height:.31750199999999995em"><span style="top:-2.5500000000000003em;margin-right:.05em"><span class="pstrut"style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight text"><span class="mord mtight">iv</span></span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist"style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut"style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist"style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace">&#xA0;</span><span class="mord">&#x2223;</span><span class="mord">&#x2223;</span><span class="mspace">&#xA0;</span><span class="mord"><span class="mord text"><span class="mord">Enc</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-right:.05em"><span class="pstrut"style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist"style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut"style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist"style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><p>Next, To perform CRT, we have to make sure all Ns are coprime first, we calculate the gcd of all N pairwisely, and strip off those divisor. Now, we can recover the key with hastad attack.</p><p>To decrypt the flag, we have to know what iv is. We can get encrypted iv with plaintext of all zeros: <span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mtext>Enc</mtext><mtext>iv</mtext></msub><mo>(</mo><mn>0</mn><mo>)</mo><mo>=</mo><msub><mtext>Enc</mtext><mn>0</mn></msub><mo>(</mo><mtext>iv</mtext><mo>&#x2295;</mo><mn>0</mn><mo>)</mo><mo>=</mo><msub><mtext>Enc</mtext><mn>0</mn></msub><mo>(</mo><mtext>iv</mtext><mo>)</mo></mrow><annotation encoding="application/x-tex">\text{Enc}_{\text{iv}}(0) = \text{Enc}_{0}(\text{iv} \oplus 0) = \text{Enc}_{0}(\text{iv})</annotation></semantics></math></span><span class="katex-html"aria-hidden="true"><span class="base"><span class="strut"style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord text"><span class="mord">Enc</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"style="height:.31750199999999995em"><span style="top:-2.5500000000000003em;margin-right:.05em"><span class="pstrut"style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight text"><span class="mord mtight">iv</span></span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist"style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">0</span><span class="mclose">)</span><span class="mspace"style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace"style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut"style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord text"><span class="mord">Enc</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-right:.05em"><span class="pstrut"style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist"style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord text"><span class="mord">iv</span></span><span class="mspace"style="margin-right:.2222222222222222em"></span><span class="mbin">&#x2295;</span><span class="mspace"style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut"style="height:1em;vertical-align:-.25em"></span><span class="mord">0</span><span class="mclose">)</span><span class="mspace"style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace"style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut"style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord text"><span class="mord">Enc</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-right:.05em"><span class="pstrut"style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist"style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord text"><span class="mord">iv</span></span><span class="mclose">)</span></span></span></span></span> Then we can decrypt the iv and get the flag.</p></section></div></div></div><a href="../lostmod/"class="navigation navigation-prev navigation-unique"aria-label="Previous page: crypto - Lost Modulus"><i class="fa fa-angle-left"></i></a></div><script>var gitbook=gitbook||[];gitbook.push(function(){gitbook.page.hasChanged({page:{name:"Secret Note",category:"crypwn",points:342,solves:9,title:"crypwn - Secret Note",level:"5.3.2",depth:2,next:{title:"Hack.lu",level:"5.4",depth:1,ref:"",articles:[{title:"crypto - Escape the Grid",level:"5.4.1",depth:2,path:"writeup/2018/Hack.lu/crypto/escape/README.md",ref:"writeup/2018/Hack.lu/crypto/escape/README.md",articles:[]},{title:"crypto - Relations",level:"5.4.2",depth:2,path:"writeup/2018/Hack.lu/crypto/relation/README.md",ref:"writeup/2018/Hack.lu/crypto/relation/README.md",articles:[]},{title:"crypto - LFSR StreamCipher",level:"5.4.3",depth:2,path:"writeup/2018/Hack.lu/crypto/lfsr/README.md",ref:"writeup/2018/Hack.lu/crypto/lfsr/README.md",articles:[{title:"task description",level:"5.4.3.1",depth:3,path:"writeup/2018/Hack.lu/crypto/lfsr/task.md",ref:"writeup/2018/Hack.lu/crypto/lfsr/task.md",articles:[]}]}]},previous:{title:"crypto - Lost Modulus",level:"5.3.1",depth:2,path:"writeup/2018/hitcon/crypto/lostmod/README.md",ref:"writeup/2018/hitcon/crypto/lostmod/README.md",articles:[]},dir:"ltr"},config:{gitbook:"*",theme:"default",variables:{},plugins:["katex@git://github.com/sasdf/plugin-katex.git","disqus","prism","-highlight","html-minifier","writeup-utils@git://github.com/sasdf/gitbook-plugin-writeup-utils.git"],pluginsConfig:{prism:{css:["prismjs/themes/prism-tomorrow.css"],lang:{C:"c","C++":"cpp",asm:"nasm"}},disqus:{useIdentifier:!1,shortName:"sasdfwriteup"},search:{maxIndexSize:1e6},"html-minifier":{customAttrSurround:[],removeScriptTypeAttributes:!1,removeEmptyAttributes:!1,removeRedundantAttributes:!1,removeEmptyElements:!1,sortClassName:!0,caseSensitive:!0,html5:!0,collapseWhitespace:!0,processConditionalComments:!1,quoteCharacter:null,keepClosingSlash:!0,preventAttributesEscaping:!1,minifyURLs:!1,removeAttributeQuotes:!1,decodeEntities:!1,trimCustomFragments:!1,customAttrAssign:[],includeAutoGeneratedTags:!0,collapseInlineTagWhitespace:!1,collapseBooleanAttributes:!0,minifyJS:!0,removeTagWhitespace:!0,preserveLineBreaks:!1,sortAttributes:!0,removeStyleLinkTypeAttributes:!1,removeComments:!0,minifyCSS:!0,processScripts:[],conservativeCollapse:!1,removeOptionalTags:!1,useShortDoctype:!1},lunr:{maxIndexSize:1e6,ignoreSpecialCharacters:!1},katex:{},fontsettings:{theme:"white",family:"sans",size:2},sharing:{facebook:!0,twitter:!0,google:!1,weibo:!1,instapaper:!1,vk:!1,all:["facebook","google","twitter","weibo","instapaper"]},"theme-default":{styles:{website:"styles/website.css",pdf:"styles/pdf.css",epub:"styles/epub.css",mobi:"styles/mobi.css",ebook:"styles/ebook.css",print:"styles/print.css"},showLevel:!1},"writeup-utils":{filePrefix:"https://github.com/sasdf/ctf/blob/master",repoPrefix:"https://github.com/sasdf/ctf/blob/master",rawPrefix:"https://raw.githubusercontent.com/sasdf/ctf/master"}},structure:{langs:"LANGS.md",readme:"README.md",glossary:"GLOSSARY.md",summary:"SUMMARY.md"},pdf:{pageNumbers:!0,fontSize:12,fontFamily:"Arial",paperSize:"a4",chapterMark:"pagebreak",pageBreaksBefore:"/",margin:{right:62,left:62,top:56,bottom:56}},styles:{website:"styles/website.css",pdf:"styles/pdf.css",epub:"styles/epub.css",mobi:"styles/mobi.css",ebook:"styles/ebook.css",print:"styles/print.css"}},file:{path:"writeup/2018/hitcon/crypto/secret/README.md",mtime:"2020-08-30T19:19:46.121Z",type:"markdown"},gitbook:{version:"3.2.3",time:"2020-08-30T20:48:48.903Z"},basePath:"../../../../..",book:{language:""}})})</script></div><script src="../../../../../gitbook/gitbook.js"></script><script src="../../../../../gitbook/theme.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script><script src="../../../../../gitbook/gitbook-plugin-disqus/plugin.js"></script><script src="../../../../../gitbook/gitbook-plugin-search/lunr.min.js"></script><script src="../../../../../gitbook/gitbook-plugin-search/search.js"></script><script src="../../../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script><script src="../../../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script><script src="../../../../../gitbook/gitbook-plugin-sharing/buttons.js"></script><script src="../../../../../gitbook/gitbook-plugin-fontsettings/buttons.js"></script></body></html>