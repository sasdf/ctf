
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>rev - validator Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../../../gitbook/gitbook-plugin-katex/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../../../../../gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../../../gitbook/gitbook-plugin-prism/prism-tomorrow.css">
                
            
                
                <link rel="stylesheet" href="../../../../../gitbook/gitbook-plugin-writeup-utils/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../memsome/" />
    
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../../../../">
            
                <a href="../../../../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Writeups</li>
        
        
    

    
        
        <li class="header">2020</li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <span>
            
                    
                    Google
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="../../../../2020/google/crypto/oracle/">
            
                <a href="../../../../2020/google/crypto/oracle/">
            
                    
                    crypto - Oracle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="../../../../2020/google/crypto/yafm/">
            
                <a href="../../../../2020/google/crypto/yafm/">
            
                    
                    crypto - YAFM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="../../../../2020/google/crypto/quantum/">
            
                <a href="../../../../2020/google/crypto/quantum/">
            
                    
                    crypto - Quantum Pyramids
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="../../../../2020/google/crypto/sharky/">
            
                <a href="../../../../2020/google/crypto/sharky/">
            
                    
                    crypto - SHArky
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">2019</li>
        
        
    
        <li class="chapter " data-level="4.1" >
            
                <span>
            
                    
                    Google
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="../../../../2019/google/crypto/reality/">
            
                <a href="../../../../2019/google/crypto/reality/">
            
                    
                    crypto - reality
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="../../../../2019/google/crypto/qkd/">
            
                <a href="../../../../2019/google/crypto/qkd/">
            
                    
                    crypto - Quantum Key Distribution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="../../../../2019/google/crypto/cell/">
            
                <a href="../../../../2019/google/crypto/cell/">
            
                    
                    crypto - Reverse a cellular automata
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="../../../../2019/google/hardware/flagrom/">
            
                <a href="../../../../2019/google/hardware/flagrom/">
            
                    
                    hardware - flagrom
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5" data-path="../../../../2019/google/hardware/minetest/">
            
                <a href="../../../../2019/google/hardware/minetest/">
            
                    
                    hardware - minetest
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6" data-path="../../../../2019/google/hardware/remote/">
            
                <a href="../../../../2019/google/hardware/remote/">
            
                    
                    hardware - Remote Control
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.7" data-path="../../../../2019/google/web/glotto/">
            
                <a href="../../../../2019/google/web/glotto/">
            
                    
                    web - gLotto
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.8" data-path="../../../../2019/google/rev/dial/">
            
                <a href="../../../../2019/google/rev/dial/">
            
                    
                    rev - Dialtone
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2" >
            
                <span>
            
                    
                    Plaid
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="../../../../2019/plaid/crypto/cypress/">
            
                <a href="../../../../2019/plaid/crypto/cypress/">
            
                    
                    crypto - SPlaid Cypress
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="../../../../2019/plaid/rev/bigmaffs/">
            
                <a href="../../../../2019/plaid/rev/bigmaffs/">
            
                    
                    rev - big maffs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">2018</li>
        
        
    
        <li class="chapter " data-level="5.1" >
            
                <span>
            
                    
                    hxp
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.1" data-path="../../../hxp/crypto/blinder_v2/">
            
                <a href="../../../hxp/crypto/blinder_v2/">
            
                    
                    crypto - blinder_v2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2" data-path="../../../hxp/crypto/blinder/">
            
                <a href="../../../hxp/crypto/blinder/">
            
                    
                    crypto - blinder
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.3" data-path="../../../hxp/crypto/curve/">
            
                <a href="../../../hxp/crypto/curve/">
            
                    
                    crypto - curve12833227
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.4" data-path="../../../hxp/crypto/oops/">
            
                <a href="../../../hxp/crypto/oops/">
            
                    
                    crypto - oops2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.5" data-path="../../../hxp/crypto/blind/">
            
                <a href="../../../hxp/crypto/blind/">
            
                    
                    crypto - blind
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.2" >
            
                <span>
            
                    
                    Pwn2Win
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.1" data-path="../../../pwn2win/rev/back_to_bletchley_park/">
            
                <a href="../../../pwn2win/rev/back_to_bletchley_park/">
            
                    
                    cryrev - Back To Bletchley Park
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2.2" data-path="../../../pwn2win/crypto/GCM/">
            
                <a href="../../../pwn2win/crypto/GCM/">
            
                    
                    crypto - GCM
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.3" >
            
                <span>
            
                    
                    HITCON
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.3.1" data-path="../../../hitcon/crypto/lostmod/">
            
                <a href="../../../hitcon/crypto/lostmod/">
            
                    
                    crypto - Lost Modulus
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.2" data-path="../../../hitcon/crypto/secret/">
            
                <a href="../../../hitcon/crypto/secret/">
            
                    
                    crypwn - Secret Note
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.4" >
            
                <span>
            
                    
                    Hack.lu
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.4.1" data-path="../../../Hack.lu/crypto/escape/">
            
                <a href="../../../Hack.lu/crypto/escape/">
            
                    
                    crypto - Escape the Grid
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.4.2" data-path="../../../Hack.lu/crypto/relation/">
            
                <a href="../../../Hack.lu/crypto/relation/">
            
                    
                    crypto - Relations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.4.3" data-path="../../../Hack.lu/crypto/lfsr/">
            
                <a href="../../../Hack.lu/crypto/lfsr/">
            
                    
                    crypto - LFSR StreamCipher
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.4.3.1" data-path="../../../Hack.lu/crypto/lfsr/task.html">
            
                <a href="../../../Hack.lu/crypto/lfsr/task.html">
            
                    
                    task description
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.5" >
            
                <span>
            
                    
                    Hackover
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.5.1" data-path="../../../HackOver/crypto/oblivious/">
            
                <a href="../../../HackOver/crypto/oblivious/">
            
                    
                    crypto - oblivious
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.5.2" data-path="../../../HackOver/crypto/secure_hash_v2/">
            
                <a href="../../../HackOver/crypto/secure_hash_v2/">
            
                    
                    crypto - secure_hash_v2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.5.3" data-path="../../../HackOver/rev/flagmaker/">
            
                <a href="../../../HackOver/rev/flagmaker/">
            
                    
                    rev - flagmaker
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.6" >
            
                <span>
            
                    
                    Teaser Dragon
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.6.1" data-path="../../../TeaserDragon/rev/Chains of trust/">
            
                <a href="../../../TeaserDragon/rev/Chains of trust/">
            
                    
                    rev - Chains of trust
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.7" >
            
                <span>
            
                    
                    Defcamp
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="5.7.1" data-path="./">
            
                <a href="./">
            
                    
                    rev - validator
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7.2" data-path="../memsome/">
            
                <a href="../memsome/">
            
                    
                    rev - memsome
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7.3" data-path="../../web/secops/">
            
                <a href="../../web/secops/">
            
                    
                    web - secops
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7.4" data-path="../../web/chat/">
            
                <a href="../../web/chat/">
            
                    
                    web - chat
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7.5" data-path="../../misc/voices/">
            
                <a href="../../misc/voices/">
            
                    
                    misc - voices
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.8" >
            
                <span>
            
                    
                    HackIT
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.8.1" data-path="../../../HackIT/coffee_overflow/">
            
                <a href="../../../HackIT/coffee_overflow/">
            
                    
                    rev - coffee_overflow
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">My Tasks</li>
        
        
    

    
        
        <li class="header">2018</li>
        
        
    
        <li class="chapter " data-level="7.1" >
            
                <span>
            
                    
                    AIS3 Final
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1.1" data-path="../../../../../tasks/2018/ais3Final/crypto/100-mama/">
            
                <a href="../../../../../tasks/2018/ais3Final/crypto/100-mama/">
            
                    
                    crypto - mama
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.1.2" data-path="../../../../../tasks/2018/ais3Final/crypto/200-secureSub/">
            
                <a href="../../../../../tasks/2018/ais3Final/crypto/200-secureSub/">
            
                    
                    crypto - secureSub
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.1.3" data-path="../../../../../tasks/2018/ais3Final/crypto/300-xorlnarmoni'akda/">
            
                <a href="../../../../../tasks/2018/ais3Final/crypto/300-xorlnarmoni'akda/">
            
                    
                    crypto - xorlnarmoni'akda
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.1.4" data-path="../../../../../tasks/2018/ais3Final/rev/100-SecDES/">
            
                <a href="../../../../../tasks/2018/ais3Final/rev/100-SecDES/">
            
                    
                    rev - SecDES
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.1.5" data-path="../../../../../tasks/2018/ais3Final/rev/200-AlmightyDuctTape/">
            
                <a href="../../../../../tasks/2018/ais3Final/rev/200-AlmightyDuctTape/">
            
                    
                    rev - Almighty Duct Tape
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">2019</li>
        
        
    
        <li class="chapter " data-level="8.1" >
            
                <span>
            
                    
                    Balsn CTF
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1.1" data-path="../../../../../tasks/2019/BalsnCTF/">
            
                <a href="../../../../../tasks/2019/BalsnCTF/">
            
                    
                    Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.2" data-path="../../../../../tasks/2019/BalsnCTF/crypto/collision/">
            
                <a href="../../../../../tasks/2019/BalsnCTF/crypto/collision/">
            
                    
                    crypto - collision
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.3" data-path="../../../../../tasks/2019/BalsnCTF/crypto/harc4/">
            
                <a href="../../../../../tasks/2019/BalsnCTF/crypto/harc4/">
            
                    
                    crypto - harc4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.4" data-path="../../../../../tasks/2019/BalsnCTF/crypto/unpredictable/">
            
                <a href="../../../../../tasks/2019/BalsnCTF/crypto/unpredictable/">
            
                    
                    crypto - unpredictable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.5" data-path="../../../../../tasks/2019/BalsnCTF/pwn/securenote/">
            
                <a href="../../../../../tasks/2019/BalsnCTF/pwn/securenote/">
            
                    
                    crypwn - securenote
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.6" data-path="../../../../../tasks/2019/BalsnCTF/misc/pyshv1/">
            
                <a href="../../../../../tasks/2019/BalsnCTF/misc/pyshv1/">
            
                    
                    misc - pyshv1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.7" data-path="../../../../../tasks/2019/BalsnCTF/misc/pyshv2/">
            
                <a href="../../../../../tasks/2019/BalsnCTF/misc/pyshv2/">
            
                    
                    misc - pyshv2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.8" data-path="../../../../../tasks/2019/BalsnCTF/misc/pyshv3/">
            
                <a href="../../../../../tasks/2019/BalsnCTF/misc/pyshv3/">
            
                    
                    misc - pyshv3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.9" data-path="../../../../../tasks/2019/BalsnCTF/misc/john/">
            
                <a href="../../../../../tasks/2019/BalsnCTF/misc/john/">
            
                    
                    misc - john
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.10" data-path="../../../../../tasks/2019/BalsnCTF/rev/plam/">
            
                <a href="../../../../../tasks/2019/BalsnCTF/rev/plam/">
            
                    
                    rev - plam
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.11" data-path="../../../../../tasks/2019/BalsnCTF/rev/vim/">
            
                <a href="../../../../../tasks/2019/BalsnCTF/rev/vim/">
            
                    
                    rev - vim
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../../../.." >rev - validator</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
                                <section class="normal markdown-section">
                                
                                <div class="wpHeaderContainer">
                    <h1 id="validator">validator</h1>
                    <div>
                        <span><a href="https://github.com/sasdf/ctf/blob/master/writeup/2018/defcamp/rev/validator" target="_blank"><img src="https://img.shields.io/badge/-Attachments-lightgrey.svg?style=for-the-badge&amp;maxAge=3600&amp;logo=github" alt="Attachments"></a></span><span><img src="https://img.shields.io/badge/rev-369-green.svg?style=for-the-badge&amp;maxAge=3600" alt="rev - 369"></span><span><img src="https://img.shields.io/badge/solves-8-lightseagreen.svg?style=for-the-badge&amp;maxAge=3600" alt="8 solves"></span></div>
                </div><p></p>
<blockquote>
<p>Like any good admin, we don&apos;t store the flag, we validate that it can be generated.</p>
</blockquote>
<h2 id="time">Time</h2>
<p>6 hours</p>
<h1 id="solution">Solution</h1>
<h2 id="tldr">TL;DR</h2>
<ol>
<li>Extract the xor table</li>
<li>Recover the order of goroutine chain</li>
<li>Recover the last output (i.e. flag)</li>
<li>Append <code>}</code> to the flag</li>
</ol>
<p>This is a challenge about Go and goroutine.
To recover the symbol, see
<a href="https://rednaga.io/2016/09/21/reversing_go_binaries_like_a_pro/" target="_blank">Reversing GO binaries like a pro</a>.</p>
<h2 id="main">Main</h2>
<p>IDA Pro doesn&apos;t support stack calling convention that Go use.
Argument and return value are not correct,
You&apos;ll need to check the asm code to figure out correct values.</p>
<p>First loop in main is:</p>
<pre class="language-"><code class="lang-C++"><span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> const_num_11<span class="token punctuation">;</span> i <span class="token operator">=</span> v6 <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  _i <span class="token operator">=</span> i<span class="token punctuation">;</span>
  <span class="token function">runtime_makechan</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> v6<span class="token punctuation">,</span> i<span class="token punctuation">,</span> v10<span class="token punctuation">,</span> v7<span class="token punctuation">,</span> v8<span class="token punctuation">,</span> <span class="token operator">&amp;</span>unk_49B3C0<span class="token punctuation">,</span> <span class="token number">1uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v12 <span class="token operator">=</span> _i<span class="token punctuation">;</span>
  v13 <span class="token operator">=</span> inputLen<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> _i <span class="token operator">&gt;=</span> inputLen <span class="token punctuation">)</span>
    <span class="token function">runtime_panicindex</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> v6<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v14 <span class="token operator">=</span> channels<span class="token punctuation">;</span>
  a1 <span class="token operator">=</span> <span class="token operator">&amp;</span>channels<span class="token punctuation">[</span>_i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> dword_572D30 <span class="token punctuation">)</span>
    <span class="token function">runtime_gcWriteBarrier</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    channels<span class="token punctuation">[</span>_i<span class="token punctuation">]</span> <span class="token operator">=</span> a9<span class="token punctuation">;</span>
  v6 <span class="token operator">=</span> <span class="token punctuation">(</span>v12 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v9 <span class="token operator">=</span> v13<span class="token punctuation">;</span>
  v10 <span class="token operator">=</span> v14<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>It create 11 channels and store to an array.</p>
<p>Second loop is:</p>
<pre class="language-"><code class="lang-C++"><span class="token keyword">for</span> <span class="token punctuation">(</span> j <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> const_num_11<span class="token punctuation">;</span> <span class="token operator">++</span>j <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> j <span class="token operator">&gt;=</span> _inputLen <span class="token operator">||</span> j <span class="token operator">&gt;=</span> qword_54FC38 <span class="token punctuation">)</span>
    <span class="token function">runtime_panicindex</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> _inputLen<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> const_num_11 <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span>
    v20 <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    v20 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>off_54FC30 <span class="token operator">+</span> j<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token operator">*</span><span class="token punctuation">(</span>v16 <span class="token operator">+</span> j<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> const_num_11<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v20 <span class="token operator">&gt;=</span> const_num_11 <span class="token punctuation">)</span>
    <span class="token function">runtime_panicindex</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> _inputLen<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> j <span class="token operator">&gt;=</span> v9 <span class="token operator">||</span> j <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&gt;=</span> v9 <span class="token punctuation">)</span>
    <span class="token function">runtime_panicindex</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> _inputLen<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v19 <span class="token operator">=</span> v10<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">runtime_newproc</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> _inputLen<span class="token punctuation">,</span> v10<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> v10<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> const_num_11<span class="token punctuation">,</span> <span class="token number">0x18u</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>off_4C31F0<span class="token punctuation">,</span> v10<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v9 <span class="token operator">=</span> inputLen<span class="token punctuation">;</span>
  v10 <span class="token operator">=</span> channels<span class="token punctuation">;</span>
  v15 <span class="token operator">=</span> a7<span class="token punctuation">;</span>
  v16 <span class="token operator">=</span> v47<span class="token punctuation">;</span>
  _inputLen <span class="token operator">=</span> inputLen<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>It spawning 11 new processes (i.e. goroutine). The arguments is actually:</p>
<pre class="language-"><code class="lang-asm">mov     <span class="token register variable">rbx</span>, <span class="token operator">[</span><span class="token register variable">rcx</span><span class="token operator">+</span><span class="token register variable">rdi</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">]</span>               <span class="token comment">; rcx = channels, rdi = i</span>
mov     <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">0E8h</span><span class="token operator">+</span>var_D0<span class="token operator">]</span>, <span class="token register variable">rbx</span>           <span class="token comment">; arg1 = rbx = channels[i+1]</span>
mov     <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">0E8h</span><span class="token operator">+</span>var_D8<span class="token operator">]</span>, <span class="token register variable">rdx</span>           <span class="token comment">; arg0 = rdi = channels[i]</span>
mov     <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">0E8h</span><span class="token operator">+</span>var_C8<span class="token operator">]</span>, <span class="token register variable">rax</span>           <span class="token comment">; arg2 = rax = key[k]</span>
mov     dword ptr <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">0E8h</span><span class="token operator">+</span>var_E8<span class="token operator">]</span>, <span class="token number">18h</span> <span class="token comment">; arguments has 24 bytes on stack</span>
lea     <span class="token register variable">rax</span>, off_4C31F0
mov     <span class="token operator">[</span><span class="token register variable">rsp</span><span class="token operator">+</span><span class="token number">0E8h</span><span class="token operator">+</span>var_E0<span class="token operator">]</span>, <span class="token register variable">rax</span>           <span class="token comment">; func = rax = &amp;main__Z</span>
call    runtime_newproc
</code></pre>
<p>It forms a chain of goroutine.
Proc i will have a channel between Proc i-1 and another channel to Proc i+1.</p>
<p>For the argument 2, <code>k = (input[i] ^ 0x542138[i]) % 11</code>:</p>
<pre class="language-"><code>.noptrdata:0000000000542138 unk_542138      db  83h                 ; DATA XREF: .data:off_54FC30&#x2193;o
.noptrdata:0000000000542139                 db  23h ; #
.noptrdata:000000000054213A                 db  42h ; B
.noptrdata:000000000054213B                 db  69h ; i
.noptrdata:000000000054213C                 db  23h ; #
.noptrdata:000000000054213D                 db 0B2h
.noptrdata:000000000054213E                 db  0Eh
.noptrdata:000000000054213F                 db  28h ; (
.noptrdata:0000000000542140                 db  97h
.noptrdata:0000000000542141                 db 0DFh
.noptrdata:0000000000542142                 db  14h
</code></pre><p>and keys is a array of structures in 0x553C60 (totally 11 * 0x58 bytes long).</p>
<pre class="language-"><code>.data:0000000000553C60 qword_553C60    dq 0                    ; DATA XREF: .data:off_54FC50&#x2191;o
.data:0000000000553C68                 dq offset unk_5426E0
.data:0000000000553C70                 dq 13h
.data:0000000000553C78                 dq 13h
.data:0000000000553C80                 dq offset unk_5426C0
.data:0000000000553C88                 dq 13h
.data:0000000000553C90                 dq 13h
.data:0000000000553C98                 dq 1Ah
.data:0000000000553CA0                 dq offset unk_542F00
.data:0000000000553CA8                 dq 24h
.data:0000000000553CB0                 dq 24h
...
</code></pre><p>Then it creates a result channel and creates two other process with different functions:</p>
<pre class="language-"><code class="lang-C++">lastChan <span class="token operator">=</span> __channels<span class="token punctuation">[</span>v9 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">runtime_makechan</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> _inputLen<span class="token punctuation">,</span> v15<span class="token punctuation">,</span> <span class="token operator">&amp;</span>unk_49B440<span class="token punctuation">,</span> off_54FC50<span class="token punctuation">,</span> qword_54FC58<span class="token punctuation">,</span> <span class="token operator">&amp;</span>unk_49B440<span class="token punctuation">,</span> <span class="token number">1uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
resultChan <span class="token operator">=</span> a9<span class="token punctuation">;</span>
<span class="token function">runtime_newproc</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> _inputLen<span class="token punctuation">,</span> v21<span class="token punctuation">,</span> <span class="token operator">&amp;</span>hashChecker<span class="token punctuation">,</span> v22<span class="token punctuation">,</span> v23<span class="token punctuation">,</span> <span class="token number">0x10u</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>hashChecker<span class="token punctuation">,</span> lastChan<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">runtime_newproc</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> _inputLen<span class="token punctuation">,</span> v24<span class="token punctuation">,</span> <span class="token operator">&amp;</span>procTimeout<span class="token punctuation">,</span> v25<span class="token punctuation">,</span> v26<span class="token punctuation">,</span> <span class="token number">8u</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>procTimeout<span class="token punctuation">,</span> resultChan<span class="token punctuation">)</span><span class="token punctuation">;</span>
a8 <span class="token operator">=</span> v47<span class="token punctuation">;</span>
v56 <span class="token operator">=</span> inputLen<span class="token punctuation">;</span>
v57 <span class="token operator">=</span> v43<span class="token punctuation">;</span>
<span class="token function">runtime_chansend1</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> _inputLen<span class="token punctuation">,</span> v27<span class="token punctuation">,</span> v28<span class="token punctuation">,</span> v29<span class="token punctuation">,</span> v30<span class="token punctuation">,</span> a7<span class="token punctuation">,</span> <span class="token operator">&amp;</span>a8<span class="token punctuation">)</span><span class="token punctuation">;</span>
isCorrect <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
<span class="token function">runtime_chanrecv1</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> _inputLen<span class="token punctuation">,</span> v31<span class="token punctuation">,</span> v32<span class="token punctuation">,</span> v33<span class="token punctuation">,</span> v34<span class="token punctuation">,</span> resultChan<span class="token punctuation">,</span> <span class="token operator">&amp;</span>isCorrect<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span> isCorrect <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// print correct</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span> <span class="token comment">// else if ...</span>
</code></pre>
<p>Check the arguments in asm like what we just done,
It passes the last element in channels and the result channel to hashChecker (<code>main___CRRt</code>).
It passes the result channel to procTimeout(<code>main___4</code>).
Then it sends the input to the first channel,
and waits for the result and output it.</p>
<h2 id="timeout-and-hash-checker">Timeout and hash checker</h2>
<p>procTimeout send 2 to the result channel after 1 second.
hashChecker send 0 if the data from the last channel is correct, otherwise send 1.
You could nop procTimeout to avoid the program exiting while debugging.</p>
<pre class="language-"><code class="lang-C++">__int64 __fastcall <span class="token function">main___4</span><span class="token punctuation">(</span>__int64 a1<span class="token punctuation">,</span> __int64 a2<span class="token punctuation">,</span> __int64 a3<span class="token punctuation">,</span> __int64 a4<span class="token punctuation">,</span> __int64 a5<span class="token punctuation">,</span> __int64 a6<span class="token punctuation">,</span> __int64 a7<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">&amp;</span>retaddr <span class="token operator">&lt;=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0xFFFFFFF8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token function">runtime_morestack_noctxt</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">time_Sleep</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">runtime_chansend1</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> v7<span class="token punctuation">,</span> v8<span class="token punctuation">,</span> v9<span class="token punctuation">,</span> v10<span class="token punctuation">,</span> a7<span class="token punctuation">,</span> <span class="token operator">&amp;</span>unk_4CF870<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
__int64 __fastcall <span class="token function">main_CRRt</span><span class="token punctuation">(</span>__int64 a1<span class="token punctuation">,</span> __int64 a2<span class="token punctuation">,</span> <span class="token keyword">char</span> a3<span class="token punctuation">,</span> __int64 a4<span class="token punctuation">,</span> __int64 a5<span class="token punctuation">,</span> __int64 a6<span class="token punctuation">,</span> __int64 a7<span class="token punctuation">,</span> __int64 a8<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">&amp;</span>v26 <span class="token operator">+</span> <span class="token number">8</span> <span class="token operator">&lt;=</span> <span class="token operator">*</span><span class="token punctuation">(</span>v8 <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token function">runtime_morestack_noctxt</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">*</span><span class="token operator">&amp;</span>v32 <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v32 <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token function">runtime_chanrecv1</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> a3<span class="token punctuation">,</span> v8<span class="token punctuation">,</span> a5<span class="token punctuation">,</span> a6<span class="token punctuation">,</span> a7<span class="token punctuation">,</span> <span class="token operator">&amp;</span>v32<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">crypto_sha512_Sum512</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> v32<span class="token punctuation">,</span> <span class="token function">__PAIR__</span><span class="token punctuation">(</span>v9<span class="token punctuation">,</span> v33<span class="token punctuation">)</span><span class="token punctuation">,</span> v32<span class="token punctuation">,</span> v10<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v24 <span class="token operator">=</span> v20<span class="token punctuation">;</span>
  v25 <span class="token operator">=</span> v21<span class="token punctuation">;</span>
  v26 <span class="token operator">=</span> v22<span class="token punctuation">;</span>
  v27 <span class="token operator">=</span> v23<span class="token punctuation">;</span>
  v28 <span class="token operator">=</span> xmmword_4D03A0<span class="token punctuation">;</span>
  v29 <span class="token operator">=</span> xmmword_4D03B0<span class="token punctuation">;</span>
  v30 <span class="token operator">=</span> xmmword_4D03C0<span class="token punctuation">;</span>
  v31 <span class="token operator">=</span> xmmword_4D03D0<span class="token punctuation">;</span>
  <span class="token function">bytes_Equal</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> v11<span class="token punctuation">,</span> v12<span class="token punctuation">,</span> v13<span class="token punctuation">,</span> v14<span class="token punctuation">,</span> <span class="token operator">&amp;</span>v24<span class="token punctuation">,</span> <span class="token number">64LL</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v28<span class="token punctuation">,</span> <span class="token number">64LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">BYTE8</span><span class="token punctuation">(</span>v21<span class="token punctuation">)</span> <span class="token punctuation">)</span>
    result <span class="token operator">=</span> <span class="token function">runtime_chansend1</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> v15<span class="token punctuation">,</span> v16<span class="token punctuation">,</span> v17<span class="token punctuation">,</span> v18<span class="token punctuation">,</span> a8<span class="token punctuation">,</span> <span class="token operator">&amp;</span>success_0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    result <span class="token operator">=</span> <span class="token function">runtime_chansend1</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> v15<span class="token punctuation">,</span> v16<span class="token punctuation">,</span> v17<span class="token punctuation">,</span> v18<span class="token punctuation">,</span> a8<span class="token punctuation">,</span> <span class="token operator">&amp;</span>notQuite<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="transformer-chain">Transformer Chain</h2>
<p>The function takes three arguments: input channel, output channel, and a structure about key.</p>
<pre class="language-"><code class="lang-C++">__int64 __fastcall <span class="token function">main__Z</span><span class="token punctuation">(</span>__int64 a1<span class="token punctuation">,</span> __int64 a2<span class="token punctuation">,</span> <span class="token keyword">char</span> a3<span class="token punctuation">,</span> __int64 a4<span class="token punctuation">,</span> __int64 a5<span class="token punctuation">,</span> __int64 a6<span class="token punctuation">,</span> __int64 a7<span class="token punctuation">,</span> __int64 a8<span class="token punctuation">,</span> _QWORD <span class="token operator">*</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">runtime_chanrecv1</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> a3<span class="token punctuation">,</span> v9<span class="token punctuation">,</span> a5<span class="token punctuation">,</span> a6<span class="token punctuation">,</span> a7<span class="token punctuation">,</span> <span class="token operator">&amp;</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Check part of input is correct</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    v14 <span class="token operator">=</span> key<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> i <span class="token operator">&gt;=</span> key<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    v15 <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token operator">*</span>key<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> v15 <span class="token operator">&gt;=</span> nrecv <span class="token punctuation">)</span>
      <span class="token keyword">return</span> _nrecv<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> v15 <span class="token operator">&gt;=</span> nrecv <span class="token operator">||</span> <span class="token punctuation">(</span>v14 <span class="token operator">=</span> <span class="token punctuation">(</span>input<span class="token punctuation">[</span>v15<span class="token punctuation">]</span> <span class="token operator">^</span> v14<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v10 <span class="token operator">=</span> key<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i <span class="token operator">&gt;=</span> v10<span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token function">runtime_panicindex</span><span class="token punctuation">(</span>v14<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> v14 <span class="token operator">!=</span> <span class="token operator">*</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+</span> i<span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token keyword">return</span> _nrecv<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// data[key[7]:][:key[9]] ^= key[8][:]</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> j <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>j <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    v17 <span class="token operator">=</span> key<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    v18 <span class="token operator">=</span> key<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> j <span class="token operator">&gt;=</span> v18 <span class="token punctuation">)</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    v19 <span class="token operator">=</span> j <span class="token operator">+</span> key<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> v19 <span class="token operator">&gt;=</span> _nrecv <span class="token punctuation">)</span>
      <span class="token keyword">return</span> _nrecv<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> v19 <span class="token operator">&gt;=</span> _nrecv <span class="token punctuation">)</span>
      <span class="token function">runtime_panicindex</span><span class="token punctuation">(</span>v17<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
    v10 <span class="token operator">=</span> _input<span class="token punctuation">[</span>v19<span class="token punctuation">]</span><span class="token punctuation">;</span>
    _input<span class="token punctuation">[</span>v19<span class="token punctuation">]</span> <span class="token operator">=</span> v10 <span class="token operator">^</span> v17<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Send data to next goroutine</span>
  <span class="token operator">*</span><span class="token operator">&amp;</span>_nrecv <span class="token operator">=</span> <span class="token function">runtime_chansend1</span><span class="token punctuation">(</span>v17<span class="token punctuation">,</span> j<span class="token punctuation">,</span> <span class="token function">SBYTE8</span><span class="token punctuation">(</span>_nrecv<span class="token punctuation">)</span><span class="token punctuation">,</span> _input<span class="token punctuation">,</span> v18<span class="token punctuation">,</span> v10<span class="token punctuation">,</span> a8<span class="token punctuation">,</span> <span class="token operator">&amp;</span>v23<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>It will check partial data is same as expected,
change partial data by xor with a array in key.
and send to next goroutine.
The operations are:</p>
<pre class="language-"><code>Keys:
Index 0
[ 0:19] == 8321436325b1062c90da1db8f11bd94d3b0892
[26:62] ^= 6d955bc81686c8ed201d0767c68627f2e4fa3dea42583f6f45d451c580da6b38f6cc8d12

Index 1
[10:35] == 1db8f11bd94d3b089241dbef5bc359544dbbaa11efd7143b89
[ 6:59] ^= 46d0ba9f2f3a311f9bba0b03fb8cfa15294ff4bb1e62a68bd1ebbb6ef390a10918ba7d81e4ae745327acde37b26fc3d1d2034fe744

Index 2
[ 5:56] == b1062c90da1db8f11bd94d3b089241dbef5bc359544dbbaa11efd7143b896579cacefa585455da8673f7c702b9c0059e262d15
[53:69] ^= 521ae780305adaa32d47c3029cda6def

Index 3
[53:69] == e9d24b93a792a29b86820f6c2d353134
[ 5:31] ^= 2399ca610a706ee1ec7166774a4f6f4a12636c71dc5d6667b58e

Index 4
[40:65] == 14fc4ead8adfe51fce9cf06310e9d24b93a792a29b86820f6c
[31:49] ^= 1fb4383ac04216fd5b139f825200bd16761b

Index 5
[42:63] == c79bc1fa7bbb5acd2b8a8c29d24b93a792a29b8682
[14:63] ^= 23e2c47ae01f01c3831310299a76ead67d03dd6bff00188fec87de5e98a07f4da6ba647d5f2a6afcd7274a8761450b9daf

Index 6
[24:53] == adef53d90c9a3e3caf557af5d8c3d64025d5b174f220d044956ef06310
[26:48] ^= 67ef79da9281a66d2c8a84dfe60fae4d9e1151d26621

Index 7
[45:63] == 62f369d59cf06310e9d24b93a792a29b8682
[32:54] ^= 62d5c448202c0a9940cf0b644b9888d28f51dbe99cc0

Index 8
[17:64] == 4126a26be811e0dc33695012f522bd0938567f5c1c304f8b982f65a3f2b665956ef06310e9d24b93a792a29b86820f
[ 0:50] ^= c76217255ea3ec027e2b208d438d284be50fa38e0c48f0c0fe2b961f9a4539c4348c659210cf04aa9f6461c8292d537a5bf2

Index 9
[34:66] == 326536662fa099f25f3bbeb7dd013eb074a0e6d5056cd920f3e7901b2d0f6c2d
[38:66] ^= 4e95af906a5a8a83be325881429582b6335cee4691dfa7291a3b094c

Index 10
[12:53] == c00442f7300b69cd21fa728cadef53d90c9a3e3caf557af5d8c3d64025d5b174f220d06bdc8e726a5d
[47:64] ^= 2f49e082094d4c37ba9c7da5d9f03e2fb4
</code></pre><h2 id="order-of-the-chain">Order of the chain</h2>
<p>The Index is the position in keys&apos; array,
not the position in the chain.
The position in the chain is determine by the first 11 bytes of the input data.
Reading the above constrains carefully,
You can find that data[0:5] is only constrained by Index 0,
and only index 8 will modify it.</p>
<p>Now we assume 0 runs before 8,
so we know the first 5 bytes are <code>83 21 43 63 25</code>,
xor with our index key we extracted in the first section <code>83 23 42 69 23 b2 0e 28 97 df 14</code>.
And we got the first 5 indices, <code>0, 2, 1, 10, 6</code>.</p>
<p>Great! 0 is the first goroutine, so we know the first 19 bytes.
and the order is <code>0, 2, 1, 10, 6, 3, 8, 4, 7, 5, 9</code></p>
<p>If you assume 8 runs before 0, you won&apos;t get a reasonable result.</p>
<h2 id="flag">Flag</h2>
<p>Now emulate the chain and recover the input,
If you feed it to the program, 
It will tell you <code>this not quite lead to the flag</code>,
which is the output when whole transformer chain success,
but the data hashChecker received doesn&apos;t has correct hash.</p>
<p>When I debug the program,
I found that the hashChecker receive
<code>DCTF{1545dbabe88f4e3fcb321e9bffe622e6fa56b5a44c3f165dc607fb87274ea514</code>.
The length of flag in this CTF is 70 bytes, so the last byte must be <code>}</code>.</p>

                                
                                </section>
                            
                        </div>
                    </div>
                
            </div>

            
                
                
                <a href="../memsome/" class="navigation navigation-next navigation-unique" aria-label="Next page: rev - memsome">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"name":"validator","category":"rev","points":369,"solves":8,"title":"rev - validator","level":"5.7.1","depth":2,"next":{"title":"rev - memsome","level":"5.7.2","depth":2,"path":"writeup/2018/defcamp/rev/memsome/README.md","ref":"writeup/2018/defcamp/rev/memsome/README.md","articles":[]},"previous":{"title":"Defcamp","level":"5.7","depth":1,"ref":"","articles":[{"title":"rev - validator","level":"5.7.1","depth":2,"path":"writeup/2018/defcamp/rev/validator/README.md","ref":"writeup/2018/defcamp/rev/validator/README.md","articles":[]},{"title":"rev - memsome","level":"5.7.2","depth":2,"path":"writeup/2018/defcamp/rev/memsome/README.md","ref":"writeup/2018/defcamp/rev/memsome/README.md","articles":[]},{"title":"web - secops","level":"5.7.3","depth":2,"path":"writeup/2018/defcamp/web/secops/README.md","ref":"writeup/2018/defcamp/web/secops/README.md","articles":[]},{"title":"web - chat","level":"5.7.4","depth":2,"path":"writeup/2018/defcamp/web/chat/README.md","ref":"writeup/2018/defcamp/web/chat/README.md","articles":[]},{"title":"misc - voices","level":"5.7.5","depth":2,"path":"writeup/2018/defcamp/misc/voices/README.md","ref":"writeup/2018/defcamp/misc/voices/README.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["katex@git://github.com/sasdf/plugin-katex.git","disqus","prism","-highlight","html-minifier","writeup-utils@git://github.com/sasdf/gitbook-plugin-writeup-utils.git"],"pluginsConfig":{"prism":{"css":["prismjs/themes/prism-tomorrow.css"],"lang":{"C":"c","C++":"cpp","asm":"nasm"}},"disqus":{"useIdentifier":false,"shortName":"sasdfwriteup"},"search":{"maxIndexSize":1000000},"html-minifier":{"customAttrSurround":[],"removeScriptTypeAttributes":false,"removeEmptyAttributes":false,"removeRedundantAttributes":false,"removeEmptyElements":false,"sortClassName":true,"caseSensitive":true,"html5":true,"collapseWhitespace":true,"processConditionalComments":false,"quoteCharacter":null,"keepClosingSlash":true,"preventAttributesEscaping":false,"minifyURLs":false,"removeAttributeQuotes":false,"decodeEntities":false,"trimCustomFragments":false,"customAttrAssign":[],"includeAutoGeneratedTags":true,"collapseInlineTagWhitespace":false,"collapseBooleanAttributes":true,"minifyJS":true,"removeTagWhitespace":true,"preserveLineBreaks":false,"sortAttributes":true,"removeStyleLinkTypeAttributes":false,"removeComments":true,"minifyCSS":true,"processScripts":[],"conservativeCollapse":false,"removeOptionalTags":false,"useShortDoctype":false},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"katex":{},"fontsettings":{"theme":"white","family":"sans","size":2},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"writeup-utils":{"filePrefix":"https://github.com/sasdf/ctf/blob/master","repoPrefix":"https://github.com/sasdf/ctf/blob/master","rawPrefix":"https://raw.githubusercontent.com/sasdf/ctf/master"}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"writeup/2018/defcamp/rev/validator/README.md","mtime":"2020-08-30T20:59:08.307Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-08-30T20:59:19.877Z"},"basePath":"../../../../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../../../../gitbook/gitbook.js"></script>
    <script src="../../../../../gitbook/theme.js"></script>
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="../../../../../gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="../../../../../gitbook/gitbook-plugin-search/lunr.min.js"></script>
        
    
        
        <script src="../../../../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../../../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../../../../gitbook/gitbook-plugin-fontsettings/buttons.js"></script>
        
    

    </body>
</html>

