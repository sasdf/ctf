<!DOCTYPE HTML><html lang=""><head><meta charset="UTF-8"><meta content="text/html; charset=utf-8"http-equiv="Content-Type"><title>crypto - YAFM Â· GitBook</title><meta content="IE=edge"http-equiv="X-UA-Compatible"/><meta content=""name="description"><meta content="GitBook 3.2.3"name="generator"><link href="../../../../../gitbook/style.css"rel="stylesheet"><link href="../../../../../gitbook/gitbook-plugin-katex/katex.min.css"rel="stylesheet"><link href="../../../../../gitbook/gitbook-plugin-disqus/plugin.css"rel="stylesheet"><link href="../../../../../gitbook/gitbook-plugin-prism/prism-tomorrow.css"rel="stylesheet"><link href="../../../../../gitbook/gitbook-plugin-writeup-utils/plugin.css"rel="stylesheet"><link href="../../../../../gitbook/gitbook-plugin-search/search.css"rel="stylesheet"><link href="../../../../../gitbook/gitbook-plugin-fontsettings/website.css"rel="stylesheet"><meta content="true"name="HandheldFriendly"/><meta content="width=device-width,initial-scale=1,user-scalable=no"name="viewport"><meta content="yes"name="apple-mobile-web-app-capable"><meta content="black"name="apple-mobile-web-app-status-bar-style"><link href="../../../../../gitbook/images/apple-touch-icon-precomposed-152.png"rel="apple-touch-icon-precomposed"sizes="152x152"><link href="../../../../../gitbook/images/favicon.ico"rel="shortcut icon"type="image/x-icon"><link href="../quantum/"rel="next"/><link href="../oracle/"rel="prev"/></head><body><div class="book"><div class="book-summary"><nav role="navigation"><ul class="summary"><li class="chapter"data-level="1.1"data-path="../../../../../"><a href="../../../../../">Introduction</a></li><li class="header">Writeups</li><li class="header">2020</li><li class="chapter"data-level="3.1"><span>TWCTF</span><ul class="articles"><li class="chapter"data-level="3.1.1"data-path="../../../tokyoWesterns/rev/metal/"><a href="../../../tokyoWesterns/rev/metal/">rev - metal</a></li><li class="chapter"data-level="3.1.2"data-path="../../../tokyoWesterns/crypto/xs/"><a href="../../../tokyoWesterns/crypto/xs/">crypto - XOR and shift encryptor</a></li></ul></li><li class="chapter"data-level="3.2"><span>Google</span><ul class="articles"><li class="chapter"data-level="3.2.1"data-path="../oracle/"><a href="../oracle/">crypto - Oracle</a></li><li class="chapter active"data-level="3.2.2"data-path="./"><a href="./">crypto - YAFM</a></li><li class="chapter"data-level="3.2.3"data-path="../quantum/"><a href="../quantum/">crypto - Quantum Pyramids</a></li><li class="chapter"data-level="3.2.4"data-path="../sharky/"><a href="../sharky/">crypto - SHArky</a></li></ul></li><li class="header">2019</li><li class="chapter"data-level="4.1"><span>Google</span><ul class="articles"><li class="chapter"data-level="4.1.1"data-path="../../../../2019/google/crypto/reality/"><a href="../../../../2019/google/crypto/reality/">crypto - reality</a></li><li class="chapter"data-level="4.1.2"data-path="../../../../2019/google/crypto/qkd/"><a href="../../../../2019/google/crypto/qkd/">crypto - Quantum Key Distribution</a></li><li class="chapter"data-level="4.1.3"data-path="../../../../2019/google/crypto/cell/"><a href="../../../../2019/google/crypto/cell/">crypto - Reverse a cellular automata</a></li><li class="chapter"data-level="4.1.4"data-path="../../../../2019/google/hardware/flagrom/"><a href="../../../../2019/google/hardware/flagrom/">hardware - flagrom</a></li><li class="chapter"data-level="4.1.5"data-path="../../../../2019/google/hardware/minetest/"><a href="../../../../2019/google/hardware/minetest/">hardware - minetest</a></li><li class="chapter"data-level="4.1.6"data-path="../../../../2019/google/hardware/remote/"><a href="../../../../2019/google/hardware/remote/">hardware - Remote Control</a></li><li class="chapter"data-level="4.1.7"data-path="../../../../2019/google/web/glotto/"><a href="../../../../2019/google/web/glotto/">web - gLotto</a></li><li class="chapter"data-level="4.1.8"data-path="../../../../2019/google/rev/dial/"><a href="../../../../2019/google/rev/dial/">rev - Dialtone</a></li></ul></li><li class="chapter"data-level="4.2"><span>Plaid</span><ul class="articles"><li class="chapter"data-level="4.2.1"data-path="../../../../2019/plaid/crypto/cypress/"><a href="../../../../2019/plaid/crypto/cypress/">crypto - SPlaid Cypress</a></li><li class="chapter"data-level="4.2.2"data-path="../../../../2019/plaid/rev/bigmaffs/"><a href="../../../../2019/plaid/rev/bigmaffs/">rev - big maffs</a></li></ul></li><li class="header">2018</li><li class="chapter"data-level="5.1"><span>hxp</span><ul class="articles"><li class="chapter"data-level="5.1.1"data-path="../../../../2018/hxp/crypto/blinder_v2/"><a href="../../../../2018/hxp/crypto/blinder_v2/">crypto - blinder_v2</a></li><li class="chapter"data-level="5.1.2"data-path="../../../../2018/hxp/crypto/blinder/"><a href="../../../../2018/hxp/crypto/blinder/">crypto - blinder</a></li><li class="chapter"data-level="5.1.3"data-path="../../../../2018/hxp/crypto/curve/"><a href="../../../../2018/hxp/crypto/curve/">crypto - curve12833227</a></li><li class="chapter"data-level="5.1.4"data-path="../../../../2018/hxp/crypto/oops/"><a href="../../../../2018/hxp/crypto/oops/">crypto - oops2</a></li><li class="chapter"data-level="5.1.5"data-path="../../../../2018/hxp/crypto/blind/"><a href="../../../../2018/hxp/crypto/blind/">crypto - blind</a></li></ul></li><li class="chapter"data-level="5.2"><span>Pwn2Win</span><ul class="articles"><li class="chapter"data-level="5.2.1"data-path="../../../../2018/pwn2win/rev/back_to_bletchley_park/"><a href="../../../../2018/pwn2win/rev/back_to_bletchley_park/">cryrev - Back To Bletchley Park</a></li><li class="chapter"data-level="5.2.2"data-path="../../../../2018/pwn2win/crypto/GCM/"><a href="../../../../2018/pwn2win/crypto/GCM/">crypto - GCM</a></li></ul></li><li class="chapter"data-level="5.3"><span>HITCON</span><ul class="articles"><li class="chapter"data-level="5.3.1"data-path="../../../../2018/hitcon/crypto/lostmod/"><a href="../../../../2018/hitcon/crypto/lostmod/">crypto - Lost Modulus</a></li><li class="chapter"data-level="5.3.2"data-path="../../../../2018/hitcon/crypto/secret/"><a href="../../../../2018/hitcon/crypto/secret/">crypwn - Secret Note</a></li></ul></li><li class="chapter"data-level="5.4"><span>Hack.lu</span><ul class="articles"><li class="chapter"data-level="5.4.1"data-path="../../../../2018/Hack.lu/crypto/escape/"><a href="../../../../2018/Hack.lu/crypto/escape/">crypto - Escape the Grid</a></li><li class="chapter"data-level="5.4.2"data-path="../../../../2018/Hack.lu/crypto/relation/"><a href="../../../../2018/Hack.lu/crypto/relation/">crypto - Relations</a></li><li class="chapter"data-level="5.4.3"data-path="../../../../2018/Hack.lu/crypto/lfsr/"><a href="../../../../2018/Hack.lu/crypto/lfsr/">crypto - LFSR StreamCipher</a><ul class="articles"><li class="chapter"data-level="5.4.3.1"data-path="../../../../2018/Hack.lu/crypto/lfsr/task.html"><a href="../../../../2018/Hack.lu/crypto/lfsr/task.html">task description</a></li></ul></li></ul></li><li class="chapter"data-level="5.5"><span>Hackover</span><ul class="articles"><li class="chapter"data-level="5.5.1"data-path="../../../../2018/HackOver/crypto/oblivious/"><a href="../../../../2018/HackOver/crypto/oblivious/">crypto - oblivious</a></li><li class="chapter"data-level="5.5.2"data-path="../../../../2018/HackOver/crypto/secure_hash_v2/"><a href="../../../../2018/HackOver/crypto/secure_hash_v2/">crypto - secure_hash_v2</a></li><li class="chapter"data-level="5.5.3"data-path="../../../../2018/HackOver/rev/flagmaker/"><a href="../../../../2018/HackOver/rev/flagmaker/">rev - flagmaker</a></li></ul></li><li class="chapter"data-level="5.6"><span>Teaser Dragon</span><ul class="articles"><li class="chapter"data-level="5.6.1"data-path="../../../../2018/TeaserDragon/rev/Chains of trust/"><a href="../../../../2018/TeaserDragon/rev/Chains of trust/">rev - Chains of trust</a></li></ul></li><li class="chapter"data-level="5.7"><span>Defcamp</span><ul class="articles"><li class="chapter"data-level="5.7.1"data-path="../../../../2018/defcamp/rev/validator/"><a href="../../../../2018/defcamp/rev/validator/">rev - validator</a></li><li class="chapter"data-level="5.7.2"data-path="../../../../2018/defcamp/rev/memsome/"><a href="../../../../2018/defcamp/rev/memsome/">rev - memsome</a></li><li class="chapter"data-level="5.7.3"data-path="../../../../2018/defcamp/web/secops/"><a href="../../../../2018/defcamp/web/secops/">web - secops</a></li><li class="chapter"data-level="5.7.4"data-path="../../../../2018/defcamp/web/chat/"><a href="../../../../2018/defcamp/web/chat/">web - chat</a></li><li class="chapter"data-level="5.7.5"data-path="../../../../2018/defcamp/misc/voices/"><a href="../../../../2018/defcamp/misc/voices/">misc - voices</a></li></ul></li><li class="chapter"data-level="5.8"><span>HackIT</span><ul class="articles"><li class="chapter"data-level="5.8.1"data-path="../../../../2018/HackIT/coffee_overflow/"><a href="../../../../2018/HackIT/coffee_overflow/">rev - coffee_overflow</a></li></ul></li><li class="header">My Tasks</li><li class="header">2018</li><li class="chapter"data-level="7.1"><span>AIS3 Final</span><ul class="articles"><li class="chapter"data-level="7.1.1"data-path="../../../../../tasks/2018/ais3Final/crypto/100-mama/"><a href="../../../../../tasks/2018/ais3Final/crypto/100-mama/">crypto - mama</a></li><li class="chapter"data-level="7.1.2"data-path="../../../../../tasks/2018/ais3Final/crypto/200-secureSub/"><a href="../../../../../tasks/2018/ais3Final/crypto/200-secureSub/">crypto - secureSub</a></li><li class="chapter"data-level="7.1.3"data-path="../../../../../tasks/2018/ais3Final/crypto/300-xorlnarmoni'akda/"><a href="../../../../../tasks/2018/ais3Final/crypto/300-xorlnarmoni'akda/">crypto - xorlnarmoni'akda</a></li><li class="chapter"data-level="7.1.4"data-path="../../../../../tasks/2018/ais3Final/rev/100-SecDES/"><a href="../../../../../tasks/2018/ais3Final/rev/100-SecDES/">rev - SecDES</a></li><li class="chapter"data-level="7.1.5"data-path="../../../../../tasks/2018/ais3Final/rev/200-AlmightyDuctTape/"><a href="../../../../../tasks/2018/ais3Final/rev/200-AlmightyDuctTape/">rev - Almighty Duct Tape</a></li></ul></li><li class="header">2019</li><li class="chapter"data-level="8.1"><span>Balsn CTF</span><ul class="articles"><li class="chapter"data-level="8.1.1"data-path="../../../../../tasks/2019/BalsnCTF/"><a href="../../../../../tasks/2019/BalsnCTF/">Overview</a></li><li class="chapter"data-level="8.1.2"data-path="../../../../../tasks/2019/BalsnCTF/crypto/collision/"><a href="../../../../../tasks/2019/BalsnCTF/crypto/collision/">crypto - collision</a></li><li class="chapter"data-level="8.1.3"data-path="../../../../../tasks/2019/BalsnCTF/crypto/harc4/"><a href="../../../../../tasks/2019/BalsnCTF/crypto/harc4/">crypto - harc4</a></li><li class="chapter"data-level="8.1.4"data-path="../../../../../tasks/2019/BalsnCTF/crypto/unpredictable/"><a href="../../../../../tasks/2019/BalsnCTF/crypto/unpredictable/">crypto - unpredictable</a></li><li class="chapter"data-level="8.1.5"data-path="../../../../../tasks/2019/BalsnCTF/pwn/securenote/"><a href="../../../../../tasks/2019/BalsnCTF/pwn/securenote/">crypwn - securenote</a></li><li class="chapter"data-level="8.1.6"data-path="../../../../../tasks/2019/BalsnCTF/misc/pyshv1/"><a href="../../../../../tasks/2019/BalsnCTF/misc/pyshv1/">misc - pyshv1</a></li><li class="chapter"data-level="8.1.7"data-path="../../../../../tasks/2019/BalsnCTF/misc/pyshv2/"><a href="../../../../../tasks/2019/BalsnCTF/misc/pyshv2/">misc - pyshv2</a></li><li class="chapter"data-level="8.1.8"data-path="../../../../../tasks/2019/BalsnCTF/misc/pyshv3/"><a href="../../../../../tasks/2019/BalsnCTF/misc/pyshv3/">misc - pyshv3</a></li><li class="chapter"data-level="8.1.9"data-path="../../../../../tasks/2019/BalsnCTF/misc/john/"><a href="../../../../../tasks/2019/BalsnCTF/misc/john/">misc - john</a></li><li class="chapter"data-level="8.1.10"data-path="../../../../../tasks/2019/BalsnCTF/rev/plam/"><a href="../../../../../tasks/2019/BalsnCTF/rev/plam/">rev - plam</a></li><li class="chapter"data-level="8.1.11"data-path="../../../../../tasks/2019/BalsnCTF/rev/vim/"><a href="../../../../../tasks/2019/BalsnCTF/rev/vim/">rev - vim</a></li></ul></li><li class="divider"></li><li><a href="https://www.gitbook.com"class="gitbook-link"target="blank">Published with GitBook</a></li></ul></nav></div><div class="book-body"><div class="body-inner"><div class="book-header"role="navigation"><h1><i class="fa fa-circle-o-notch fa-spin"></i> <a href="../../../../..">crypto - YAFM</a></h1></div><div class="page-wrapper"role="main"tabindex="-1"><div class="page-inner"><section class="markdown-section normal"><div class="wpHeaderContainer"><h1 id="yafm">YAFM</h1><div><span><a href="https://github.com/sasdf/ctf/blob/master/writeup/2020/google/crypto/yafm"target="_blank"><img alt="Attachments"src="https://img.shields.io/badge/-Attachments-lightgrey.svg?style=for-the-badge&amp;maxAge=3600&amp;logo=github"></a></span><span><img alt="crypto - 308"src="https://img.shields.io/badge/crypto-308-green.svg?style=for-the-badge&amp;maxAge=3600"></span><span><img alt="18 solves"src="https://img.shields.io/badge/solves-18-lightseagreen.svg?style=for-the-badge&amp;maxAge=3600"></span></div></div><p></p><blockquote><p>Yet Another Factorization Method.</p></blockquote><h2 id="time">Time</h2><p>6 hours</p><h1 id="behavior">Behavior</h1><p>This is a RSA-2048 factorization challenge, with specially crafted primes:</p><pre class="language-"><code class="lang-python"><span class="token keyword">def</span> <span class="token function">generate_prime</span><span class="token punctuation">(</span>prime_len<span class="token punctuation">)</span><span class="token punctuation">:</span>
    bits_len <span class="token operator">=</span> <span class="token number">180</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        bits <span class="token operator">=</span> random<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span>bits_len<span class="token punctuation">)</span>
        idxs <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> prime_len<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bits_len<span class="token punctuation">)</span>
        p <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">2</span><span class="token operator">**</span><span class="token punctuation">(</span>prime_len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">2</span><span class="token operator">**</span><span class="token punctuation">(</span>prime_len <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>bits_len<span class="token punctuation">)</span><span class="token punctuation">:</span>
            p <span class="token operator">+=</span> <span class="token punctuation">(</span>bits <span class="token operator">&gt;&gt;</span> i <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">**</span>idxs<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">if</span> isPrime<span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> p
</code></pre><h1 id="solution">Solution</h1><h2 id="tldr">TL;DR</h2><ol><li>Model the probability of a factor guess with binomial and hypergeometric distribution</li><li>Run best-first search to get lower bits</li><li>Factor the public key using Coppersmith&apos;s method</li></ol><h2 id="special-primes">Special primes</h2><p>This routine creates &quot;sparse&quot; primes looks like:</p><pre class="language-"><code>1100100100000100000000000000100000001000000000000000000001000000000000
0000001000000000000000000000010010010010010001000000100001000110000000
1000000000000100000000000000000000001000000000000100000000000000000000
0000000000100000000001000000000000000010000000000000000000100000000000
0000001000000000100000000100000000000000101001010000001000000000000000
0001000100010010000001000000000000000000000000010100000000010000000000
0000000000000000000000000100101000000000000000000100000100000100000000
0000000001010010000000000000000000000010000000000000000101000000000001
0000000000001100000000000001000000000100000000000001000000010000001000
0000000000000110000000000000100000010010000001000000000000100000000010
0000000000011000000000010000000001000000000000000000000000000000000000
0000010000000000000000000001000000000100000010000000001000010000000000
0000000100001000000000000000000000000000000000000100000000000000000000
0100000000000000000000000000000000010001100000000010100001001000000100
00010100000000000000000001000000000000000001
</code></pre><p>On the average, we will get primes with only 90 &apos;1&apos; bits.</p><p>However, multiplication of two such primes (i.e. n) doesn&apos;t have such special structure, although the LSBs usually tends to have more zeros:</p><pre class="language-"><code>1011110001110011110000001101110100011011110000011100111010100001011001
1101111010010101001010010110100101110011110000001111111010010010011101
1101011011101111010101000110110111010000001001110001101100011000010001
1011011010111101110101110011110110000101000110101101001110111110000111
1100000111010101111011111100011101000001010001000010100100011011010001
1110111010000010101010101110110000001100001111001111111100011100101010
0110011111010110101111000100011001001011101001001100001011010111111000
0100101100001101110111100110110101010001111101010000011001110000011010
1110001000001000111111111100111110010100111010011111101011101110000011
0100001110001100110101101011010010001111010101100000011010010011000001
1001011001001111101011001110101000011000001010101100111000010011101110
1110101111000000010011001111100010110000010111010110111010001000010011
1010101111101101010000011001011011111101001010011001100110010101000110
1110001010000111111111010111110011100110101011010000001000111000000110
0100101010100101110101001001110000011101101000000110100110110001000010
1011011110101101101011001101111011001100100011000101000101110001000010
0100010000011101110100010010100101010000000010100010111111010000001000
1000111111100101101111000110110110010000111011011010010011000000011110
1000110001100101000100101110101110011101100011101010101110111000110011
0110010101001101111001011101001100010011011111111010011101011100111010
0100000100000101100110110000101000101001100111111011110000011101101101
0101011010010100000001010001011101011101000001010101000101000011010100
0101010111101010100000110111011001110001101100100000010111101010110110
0110110110100111010010011000010101011100100101000011110010101011111000
0011100011000101000011100110100000100100000001001111111111100000000100
0100001111000111111000010111011011000110010010101110000011111001111111
0110101001011101010001100000100001110101100010001110100011111111001111
0100001001110001110101110001101001110011010111101001101001001001001111
0101011010110111001001110000000100110000100001000100010000010000010001
000000000000000001
</code></pre><p>The first things I&apos;ve tried is genetic algorithm. But this approach is able to factor primes only up to 128 bits, failed :(</p><h2 id="lower-bits">Lower bits</h2><p>The low entropy in lower bits of N gives me another direction: By guessing the lower bits of p, we have:</p><pre class="language-"><code>n = p * q
n = p * q (mod 2^32)
q = n * p^-1 (mod 2^32)
</code></pre><p>And whether $q$ is &quot;sparse&quot; or not can tell us the correctness of the guess. Furthermore, two of following equations will hold:</p><pre class="language-"><code>n =  p&apos;         *  q&apos;         (mod 2^33)
n = (p&apos; + 2^32) *  q&apos;         (mod 2^33)
n =  p&apos;         * (q&apos; + 2^32) (mod 2^33)
n = (p&apos; + 2^32) * (q&apos; + 2^32) (mod 2^33)
</code></pre><p>With this approach, we could factor the public key bit-by-bit starting from LSB. The multiplication could be replaced by addition and shifting to have better performance.</p><p>The last piece is to measure how good the guess is. From the code, we can see that prime generation has two stages, <code>random.getrandbits</code> can be modeled by binomial distribution, and <code>random.sample</code> can be modeled by hypergeometric distribution.</p><pre class="language-"><code class="lang-python">tol <span class="token operator">=</span> <span class="token number">1e</span><span class="token operator">-</span><span class="token number">6</span>
rv <span class="token operator">=</span> binom<span class="token punctuation">(</span>bits_len<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
binom_left<span class="token punctuation">,</span> binom_right <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>rv<span class="token punctuation">.</span>ppf<span class="token punctuation">(</span>tol<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>rv<span class="token punctuation">.</span>ppf<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> tol<span class="token punctuation">)</span><span class="token punctuation">)</span>
binom_values <span class="token operator">=</span> <span class="token punctuation">{</span>i<span class="token punctuation">:</span> rv<span class="token punctuation">.</span>pmf<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>binom_left<span class="token punctuation">,</span> binom_right<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span>

<span class="token punctuation annotation decorator">@functools<span class="token punctuation">.</span>lru_cache</span><span class="token punctuation">(</span>maxsize<span class="token operator">=</span><span class="token number">100000</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_proba</span><span class="token punctuation">(</span>nbits<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>b <span class="token operator">*</span> hypergeom<span class="token punctuation">.</span>pmf<span class="token punctuation">(</span>nbits<span class="token punctuation">,</span> prime_len<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> length<span class="token punctuation">)</span> <span class="token keyword">for</span> i<span class="token punctuation">,</span> b <span class="token keyword">in</span> binom_values<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><p>And I scale up the score with its length to prioritize longer guess:</p><pre class="language-"><code class="lang-python"><span class="token keyword">def</span> <span class="token function">fitness</span><span class="token punctuation">(</span>pnbits<span class="token punctuation">,</span> qnbits<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">:</span>
    qprob <span class="token operator">=</span> get_proba<span class="token punctuation">(</span>qnbits<span class="token punctuation">,</span> length<span class="token punctuation">)</span>
    pprob <span class="token operator">=</span> get_proba<span class="token punctuation">(</span>pnbits<span class="token punctuation">,</span> length<span class="token punctuation">)</span>
    prob <span class="token operator">=</span> qprob <span class="token operator">*</span> pprob <span class="token operator">*</span> length
    <span class="token keyword">return</span> prob
</code></pre><p>Armed with these tools, we are able to search the factors with best-first search. Searching for a whole factor takes too long, so we use coppersmith&apos;s method after half of the bits is recoverd.</p><p>The script for best-first search is at <a href="https://github.com/sasdf/ctf/blob/master/writeup/2020/google/crypto/yafm/_files/solve.py]"target="_blank">here</a>, and coppersmith&apos;s method is at <a href="[_files/coppersmith.sage">here</a>.</p></section></div></div></div><a href="../oracle/"class="navigation navigation-prev"aria-label="Previous page: crypto - Oracle"><i class="fa fa-angle-left"></i> </a><a href="../quantum/"class="navigation navigation-next"aria-label="Next page: crypto - Quantum Pyramids"><i class="fa fa-angle-right"></i></a></div><script>var gitbook=gitbook||[];gitbook.push(function(){gitbook.page.hasChanged({page:{name:"YAFM",category:"crypto",points:308,solves:18,title:"crypto - YAFM",level:"3.2.2",depth:2,next:{title:"crypto - Quantum Pyramids",level:"3.2.3",depth:2,path:"writeup/2020/google/crypto/quantum/README.md",ref:"writeup/2020/google/crypto/quantum/README.md",articles:[]},previous:{title:"crypto - Oracle",level:"3.2.1",depth:2,path:"writeup/2020/google/crypto/oracle/README.md",ref:"writeup/2020/google/crypto/oracle/README.md",articles:[]},dir:"ltr"},config:{gitbook:"*",theme:"default",variables:{},plugins:["katex@git://github.com/sasdf/plugin-katex.git","disqus","prism","-highlight","html-minifier","writeup-utils@git://github.com/sasdf/gitbook-plugin-writeup-utils.git"],pluginsConfig:{prism:{css:["prismjs/themes/prism-tomorrow.css"],lang:{C:"c","C++":"cpp",asm:"nasm"}},disqus:{useIdentifier:!1,shortName:"sasdfwriteup"},search:{maxIndexSize:1e6},"html-minifier":{customAttrSurround:[],removeScriptTypeAttributes:!1,removeEmptyAttributes:!1,removeRedundantAttributes:!1,removeEmptyElements:!1,sortClassName:!0,caseSensitive:!0,html5:!0,collapseWhitespace:!0,processConditionalComments:!1,quoteCharacter:null,keepClosingSlash:!0,preventAttributesEscaping:!1,minifyURLs:!1,removeAttributeQuotes:!1,decodeEntities:!1,trimCustomFragments:!1,customAttrAssign:[],includeAutoGeneratedTags:!0,collapseInlineTagWhitespace:!1,collapseBooleanAttributes:!0,minifyJS:!0,removeTagWhitespace:!0,preserveLineBreaks:!1,sortAttributes:!0,removeStyleLinkTypeAttributes:!1,removeComments:!0,minifyCSS:!0,processScripts:[],conservativeCollapse:!1,removeOptionalTags:!1,useShortDoctype:!1},lunr:{maxIndexSize:1e6,ignoreSpecialCharacters:!1},katex:{},fontsettings:{theme:"white",family:"sans",size:2},sharing:{facebook:!0,twitter:!0,google:!1,weibo:!1,instapaper:!1,vk:!1,all:["facebook","google","twitter","weibo","instapaper"]},"theme-default":{styles:{website:"styles/website.css",pdf:"styles/pdf.css",epub:"styles/epub.css",mobi:"styles/mobi.css",ebook:"styles/ebook.css",print:"styles/print.css"},showLevel:!1},"writeup-utils":{filePrefix:"https://github.com/sasdf/ctf/blob/master",repoPrefix:"https://github.com/sasdf/ctf/blob/master",rawPrefix:"https://raw.githubusercontent.com/sasdf/ctf/master"}},structure:{langs:"LANGS.md",readme:"README.md",glossary:"GLOSSARY.md",summary:"SUMMARY.md"},pdf:{pageNumbers:!0,fontSize:12,fontFamily:"Arial",paperSize:"a4",chapterMark:"pagebreak",pageBreaksBefore:"/",margin:{right:62,left:62,top:56,bottom:56}},styles:{website:"styles/website.css",pdf:"styles/pdf.css",epub:"styles/epub.css",mobi:"styles/mobi.css",ebook:"styles/ebook.css",print:"styles/print.css"}},file:{path:"writeup/2020/google/crypto/yafm/README.md",mtime:"2020-08-30T20:59:08.337Z",type:"markdown"},gitbook:{version:"3.2.3",time:"2020-09-25T17:26:22.339Z"},basePath:"../../../../..",book:{language:""}})})</script></div><script src="../../../../../gitbook/gitbook.js"></script><script src="../../../../../gitbook/theme.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script><script src="../../../../../gitbook/gitbook-plugin-disqus/plugin.js"></script><script src="../../../../../gitbook/gitbook-plugin-search/lunr.min.js"></script><script src="../../../../../gitbook/gitbook-plugin-search/search.js"></script><script src="../../../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script><script src="../../../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script><script src="../../../../../gitbook/gitbook-plugin-sharing/buttons.js"></script><script src="../../../../../gitbook/gitbook-plugin-fontsettings/buttons.js"></script></body></html>